<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelime Çizim Oyunu</title>
    <!-- Tailwind CSS ile basit ve mobil uyumlu tasarım -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        #game-container {
            width: 95%;
            max-width: 800px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        #drawing-canvas {
            border: 2px solid #3b82f6; /* Mavi çerçeve */
            background-color: #ffffff;
            touch-action: none; /* Mobil cihazlarda kaydırmayı engelle */
            cursor: crosshair;
        }
        .info-box {
            font-size: 1.1rem;
            font-weight: 700;
            padding: 8px 16px;
            border-radius: 8px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <!-- Yeni Eklenen Toplam Puan ve Tur Bilgisi -->
        <div id="game-stats" class="flex justify-between items-center mb-4 p-2 text-base bg-gray-100 rounded-lg shadow-sm">
            <div id="round-display" class="text-gray-700 font-semibold">Tur: 0</div>
            <div id="total-score-display" class="text-gray-700 font-semibold">Toplam Puan: 0</div>
        </div>

        <!-- Bilgi Paneli -->
        <div class="flex justify-between items-center mb-4 p-2">
            <div id="word-display" class="info-box bg-blue-100 text-blue-700">Çizim Kelimesi: ...</div>
            <div id="time-display" class="info-box bg-red-100 text-red-700">Süre: 15s</div>
        </div>

        <!-- Çizim Alanı -->
        <canvas id="drawing-canvas"></canvas>

        <!-- Puan ve Talimat Alanı -->
        <div id="status-message" class="text-center mt-6 h-10">
            <p id="score-display" class="text-xl font-bold text-green-600 hidden"></p>
            <button id="start-button" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg transition duration-150 shadow-md">Oyunu Başlat / Yeni Kelime</button>
        </div>
    </div>

    <script>
        // Sabitler
        const DRAWING_WORDS = ["ev", "gemi", "elma", "ağaç", "kedi", "telefon", "kitap", "balık", "bisiklet", "güneş"];
        const TIME_LIMIT = 15; // Süre 15 saniyeye düşürüldü
        const DRAW_COLOR = '#000000'; // Siyah
        const LINE_WIDTH = 5;

        // DOM Elementleri
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const wordDisplay = document.getElementById('word-display');
        const timeDisplay = document.getElementById('time-display');
        const scoreDisplay = document.getElementById('score-display');
        const startButton = document.getElementById('start-button');
        const gameContainer = document.getElementById('game-container');
        
        // Yeni Eklenen DOM Elementleri
        const roundDisplay = document.getElementById('round-display');
        const totalScoreDisplay = document.getElementById('total-score-display');

        // Oyun Durumu
        let currentWord = "";
        let isDrawing = false;
        let timerInterval = null;
        let timeLeft = TIME_LIMIT;
        let gameState = 'waiting'; // 'waiting', 'drawing', 'finished'
        let currentRound = 0; // Tur sayacı
        let totalScore = 0;   // Toplam puan
        
        // Canvas Boyutlandırma (Responsive)
        function resizeCanvas() {
            // Konteynerin genişliğini al ve 4:3 oranında yükseklik belirle
            const containerWidth = gameContainer.offsetWidth - 40; // Padding düşülmüş genişlik
            canvas.width = containerWidth;
            canvas.height = containerWidth * 0.75; 
        }

        // --- Puanlama Fonksiyonu (Düzgünlük ve Yamukluk Simülasyonu) ---
        function calculateScore() {
            // 1. Kapsam Puanı (Çizilen Alanın Yüzdesi)
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            let drawnPixels = 0;
            
            for (let i = 0; i < data.length; i += 4) {
                // Siyah (R=0, G=0, B=0) pikselleri say
                if (data[i] === 0 && data[i + 1] === 0 && data[i + 2] === 0) {
                    drawnPixels++;
                }
            }

            const totalPixels = canvas.width * canvas.height;
            const wordLength = currentWord.length;

            // Kelime uzunluğuna göre hedef piksel sayısı (Basit bir ağırlıklandırma)
            const baseTarget = 3000;
            const targetPixels = baseTarget + (wordLength * 1000); 

            // Kapsam Puanı (Coverage Score)
            const coverageScore = Math.min(100, Math.floor((drawnPixels / targetPixels) * 100));
            
            // 2. Kalite ve Düzgünlük Simülasyonu
            // Gerçek şekil tanıma mümkün olmadığından, puanlamaya "düzgünlük" katmak için süreyi kullanıyoruz.
            
            const timeSpent = TIME_LIMIT - timeLeft; // Çizim için harcanan süre
            
            // Hız Faktörü: Çizim ne kadar hızlı biterse (yani timeSpent küçükse), bu faktör o kadar yüksek olur.
            // 0 saniyede bitirilirse 1.0 (mükemmel hız), 15 saniyede bitirilirse 0.7 (yavaş) olur.
            const timeFactor = 1.0 - (timeSpent / TIME_LIMIT) * 0.3; // max 1.0, min 0.7
            
            // Rastgele "Kalite" Faktörü: Basit bir rastgelelik katmanı (Örn: 0.85 ile 1.0 arası)
            const qualityFactor = 0.85 + Math.random() * 0.15; 
            
            // 3. Final Puanı
            // Kapsam Puanı * Hız Faktörü * Kalite Faktörü
            let finalScore = Math.floor(coverageScore * timeFactor * qualityFactor);
            
            // Puanın 100'ü geçmediğinden emin ol
            finalScore = Math.min(100, finalScore);

            return finalScore;
        }

        // --- Oyun Akışı Fonksiyonları ---

        function startGame() {
            if (gameState === 'drawing') return; // Zaten çiziliyorsa başlatma

            // Turu artır
            currentRound++; 
            roundDisplay.textContent = `Tur: ${currentRound}`;

            gameState = 'drawing';
            
            // Canvas'ı temizle
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#ffffff'; // Beyaz arka plan
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Yeni kelime seç (son turdaki kelimeyi tekrar seçmemeye çalış)
            let newWord;
            do {
                newWord = DRAWING_WORDS[Math.floor(Math.random() * DRAWING_WORDS.length)];
            } while (newWord === currentWord && DRAWING_WORDS.length > 1);
            
            currentWord = newWord;
            wordDisplay.textContent = `Çiz: ${currentWord.toUpperCase()}`;
            
            // Puan ve Başlat butonunu gizle/göster
            scoreDisplay.classList.add('hidden');
            startButton.textContent = 'Çizim Başladı!';
            startButton.classList.remove('bg-indigo-500');
            startButton.classList.add('bg-gray-400', 'cursor-not-allowed');
            startButton.disabled = true; // Çizim sırasında buton devre dışı

            // Süreyi başlat
            timeLeft = TIME_LIMIT;
            timeDisplay.textContent = `Süre: ${timeLeft}s`;
            clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            timeLeft--;
            timeDisplay.textContent = `Süre: ${timeLeft}s`;

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                endGame();
            }
        }

        function endGame() {
            gameState = 'finished';
            
            const finalScore = calculateScore();
            
            // Toplam puana ekle
            totalScore += finalScore;
            totalScoreDisplay.textContent = `Toplam Puan: ${totalScore}`;
            
            // Sonuçları göster
            scoreDisplay.textContent = `SÜRE BİTTİ! Bu Tur Puanınız: ${finalScore}/100`;
            scoreDisplay.classList.remove('hidden');

            // Butonu sıfırla
            startButton.textContent = 'YENİ TUR BAŞLAT';
            startButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
            startButton.classList.add('bg-indigo-500');
            startButton.disabled = false; // Yeni tur için buton aktif
        }

        // --- Çizim Olayları (Öncekiyle Aynı) ---

        function getDrawPosition(e) {
            const rect = canvas.getBoundingClientRect();
            // Mouse veya ilk dokunuş pozisyonunu al
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function startDrawing(e) {
            if (gameState !== 'drawing') return;
            e.preventDefault(); 
            isDrawing = true;
            const pos = getDrawPosition(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
            ctx.lineCap = 'round';
            ctx.strokeStyle = DRAW_COLOR;
            ctx.lineWidth = LINE_WIDTH;
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const pos = getDrawPosition(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.closePath();
        }

        // --- Event Listener Atamaları ---

        // Mouse olayları
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // Dokunmatik (Touch) olayları (Mobil destek için)
        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);
        canvas.addEventListener('touchcancel', stopDrawing);

        // Buton ve Pencere Olayları
        startButton.addEventListener('click', startGame);
        window.addEventListener('resize', resizeCanvas);
        
        // --- Başlangıç ---
        resizeCanvas();
        wordDisplay.textContent = "Hazır Ol!";
        timeDisplay.textContent = `Süre: ${TIME_LIMIT}s`;
        startButton.textContent = 'Oyunu Başlat';

    </script>
</body>
</html>
